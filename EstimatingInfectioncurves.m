x=12.3+[-12.3 -9.90285009843787,-9.63690224291155,-9.37095438738523,-9.10500653185891,-8.83905867633259,-8.57311082080627,-8.30716296527995,-8.04121510975363,-7.77526725422731,-7.50931939870099,-7.30985850705625,-6.88877440247291,-6.62282654694659,-6.36131115567904,-6.11309315718781,-5.84714530166148,-5.55903512484130,-5.29751973357376,-5.02713941378866,-4.76119155826234,-4.51740602402988,-4.29578281109128,-4.07415959815268,-3.87469870650794,-3.69740013615706,-3.52010156580618,-3.34280299545530,-3.16550442510442,-2.98820585475354,-2.81090728440266,-2.63360871405178,-2.45631014370090,-2.27901157335002,-2.10171300299914,-1.92441443264826,-1.74711586229737,-1.54765497065263,-1.30386943642017,-1.03792158089385,-0.776406189626306,-0.506025869841212,-0.284402656902611,-0.0184548013762900,0.287385232478979,0.602090194851790,0.854740657601795,1.13398590590443,1.39993376143075,1.66588161695707,1.90966715118953,2.13129036412813,2.35291357706674,2.57453679000534,2.79616000294394,3.01778321588254,3.23940642882114,3.46102964175974,3.68265285469834,3.90427606763694,4.14806160186940,4.41400945739572,4.67995731292204,4.94590516844836,5.21185302397468,5.47780087950100,5.72158641373346,6.00969659055365,6.29780676737382,6.59921433697032,6.82970247842647,7.07348801265893,7.36159818947911,7.64970836629929,7.90457506117868];
y=[0 0.0211489100177111,0.0211489100177111,0.0211489100177111,0.0211489100177111,0.0211489100177111,0.0211489100177111,0.0211489100177111,0.0211489100177111,0.0211489100177111,0.0211489100177111,0.0211489100177111,0.117915717677111,0.166299121506814,0.253389248400271,0.359832736825613,0.553366352144412,0.795283371292914,1.10493715580299,1.48877882618528,1.99680456639713,2.49837918609836,3.03059662822506,3.63055083571334,4.20631334128677,4.76272248532832,5.36751503319957,5.97230758107082,6.60129183085692,7.24237193160045,7.89554788330140,8.54872383500235,9.20189978670330,9.83088403648940,10.4477724353181,11.0283732812745,11.5726865743586,12.1557065905065,12.7459841172288,13.3265849631852,13.7717122784185,14.0845916231839,14.2458696359495,14.3426364436089,14.2071629128858,13.9555692129713,13.6459154284613,13.1814347516961,12.6492173095694,12.0686164636130,11.4880156176566,10.9074147717002,10.3268139257438,9.73653639902149,9.13658219153320,8.53662798404492,7.94635045732258,7.36574961136618,6.79482544617572,6.22390128098526,5.68200715809262,5.10140631213622,4.52080546617982,4.02084362660625,3.55313738958582,3.11768675511852,2.76932624754467,2.39193569767302,2.05325187086511,1.74359808635504,1.52103442873841,1.32750081341962,1.12429051733487,0.940433582782013,0.819475073207762];
p12=fmincon(@(z)sum((y-100.*gampdf(x,z(1),z(2))).^2),[26 0.55])

load('Digitized_InfectionProfile_5days.mat')
x=IP(:,1)+5;
y=IP(:,2);
p5=fmincon(@(z)sum((y-gampdf(x,z(1),z(2))).^2),[7.8 1])

load('Digitized_InfectionProfile_8days.mat')
x=IP(:,1)+8;
y=IP(:,2);
p8=fmincon(@(z)sum((y-gampdf(x,z(1),z(2))).^2),[26 0.55])

load('Digitized_InfectionProfile_11days.mat')
x=IP(:,1)+11;
y=IP(:,2);
p11=fmincon(@(z)sum((y-gampdf(x,z(1),z(2))).^2),[26 2])

Inc=[5 8 11 12.3];
ya=[p5(1) p8(1) p11(1) p12(1)];
yb=[p5(2) p8(2) p11(2) p12(2)];

TT=[1:0.1:21];
av=zeros(201,1);
bv=zeros(201,1);
tv=[0:42];
% assume av has a lower bound of one such that there is a mode
for ii=1:201
   ptemp=fmincon(@(z)sum((gampdf(tv+TT(ii),z(1),z(2))-gampdf(tv+Inc(1),ya(1),yb(1))).^2+(gampdf(tv+TT(ii),z(1),z(2))-gampdf(tv+Inc(2),ya(2),yb(2))).^2+(gampdf(tv+TT(ii),z(1),z(2))-gampdf(tv+Inc(3),ya(3),yb(3))).^2+(gampdf(tv+TT(ii),z(1),z(2))-gampdf(tv+Inc(4),ya(4),yb(4))).^2),[2 2],[],[],[],[],[1 0],[inf inf]);
   av(ii)=ptemp(1);
   bv(ii)=ptemp(2);
end

close all;
t=linspace(0,42,1001);
for ii=1:21
   plot(t-ii, gampdf(t,av(ii),bv(ii)),'k'); hold on;
end